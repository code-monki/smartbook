= Smartbook Project Build Process Documentation
:author: AI Assistant
:revdate: 2025-12-14
:doctype: article
:toc: left
:toclevels: 3
:sectnums:

== Introduction

This document describes the build system, build process, and development workflow for the Smartbook project. It covers the top-level Makefile orchestration, component-specific builds, platform-specific targets, documentation generation, and testing procedures.

== Build System Overview

The Smartbook project uses a hierarchical Makefile-based build system with the following structure:

* **Top-Level Makefile:** Orchestrates builds across all components, provides unified interface for common operations
* **Component Makefiles:** Each application (Reader, Creator, Server) has its own Makefile for component-specific builds
* **Common Library:** Shared code built as dynamic library (complies with Qt LGPL requirements)
* **Test Suite:** Separate test build system with unit and integration test targets

=== Directory Structure

[source]
----
SmartBook/
├── Makefile                    # Top-level orchestration
├── .gitignore                  # Includes build/
├── reader/                     # Reader application
│   ├── Makefile               # Reader-specific build
│   ├── src/
│   ├── include/
│   └── ...
├── creator/                    # Creator Tool application
│   ├── Makefile               # Creator-specific build
│   ├── src/
│   ├── include/
│   └── ...
├── server/                     # Remote Library Server (Phase 2)
│   ├── Makefile               # Server-specific build
│   ├── src/
│   └── ...
├── common/                     # Shared code between applications
│   ├── Makefile               # Builds shared library
│   ├── src/
│   ├── include/
│   └── ...
├── test/                       # Test suite
│   ├── Makefile               # Test orchestration
│   ├── unit/                  # Unit tests
│   ├── integration/           # Integration tests
│   └── common/                # Test utilities/fixtures
├── Documentation/             # AsciiDoc sources
└── build/                     # Build artifacts (.gitignored)
    ├── linux-debian-arm64/
    ├── linux-debian-x86_64/
    ├── linux-ubuntu-x86_64/
    ├── linux-fedora-x86_64/
    ├── linux-arch-x86_64/
    ├── macos-arm64/
    ├── macos-x86_64/
    ├── windows-x86_64/
    └── docs/                  # Generated PDFs
----

== Prerequisites

=== Required Tools

**Build Tools:**
* `make` (GNU Make 4.0+)
* `cmake` (3.20+)
* C++ compiler with C++17 support:
  * Linux: `g++` (GCC 11+) or `clang++` (Clang 14+)
  * macOS: Xcode Command Line Tools (Clang 14+)
  * Windows: MSVC 2019+ or MinGW-w64

**Qt Framework:**
* Qt 6.2+ (dynamically linked, LGPL compliance)
* Qt modules required:
  * QtCore
  * QtGui
  * QtWidgets
  * QtWebEngine
  * QtWebChannel
  * QtNetwork (Phase 2)
  * QtSql

**Documentation Tools:**
* `asciidoctor` (2.0+)
* `asciidoctor-pdf` (for PDF generation)
* `mermaid-cli` or `mmdc` (for Mermaid diagram conversion to SVG/PNG)

**Platform-Specific:**
* Linux: Development packages for Qt, SQLite, libsecret
* macOS: Xcode Command Line Tools, Homebrew (optional)
* Windows: Qt installer, Visual Studio or MinGW-w64

=== Environment Setup

**Linux:**
[source,bash]
----
# Debian/Ubuntu
sudo apt-get update
sudo apt-get install build-essential cmake qt6-base-dev qt6-webengine-dev \
  qt6-webchannel-dev qt6-sql-dev libsqlite3-dev libsecret-1-dev \
  asciidoctor asciidoctor-pdf

# Fedora
sudo dnf install gcc-c++ cmake qt6-qtbase-devel qt6-qtwebengine-devel \
  qt6-qtwebchannel-devel qt6-qtsql-devel sqlite-devel libsecret-devel \
  asciidoctor asciidoctor-pdf

# Arch Linux
sudo pacman -S base-devel cmake qt6-base qt6-webengine qt6-webchannel \
  qt6-sql sqlite libsecret asciidoctor asciidoctor-pdf
----

**macOS:**
[source,bash]
----
# Install Xcode Command Line Tools
xcode-select --install

# Install Qt via Homebrew (or download from qt.io)
brew install qt@6

# Install documentation tools
brew install asciidoctor
gem install asciidoctor-pdf
npm install -g @mermaid-js/mermaid-cli
----

**Windows:**
* Install Qt 6.2+ from https://www.qt.io/download
* Install Visual Studio 2019+ or MinGW-w64
* Install Asciidoctor via Ruby installer or Chocolatey
* Install Mermaid CLI via npm

== Top-Level Makefile Targets

=== Help Target

**Usage:** `make help`

Displays all available targets with descriptions.

[source,bash]
----
$ make help
Available targets:
  help              - Display this help message
  clean             - Remove all build artifacts
  docs              - Generate all documentation PDFs
  all               - Clean, build all platforms, generate docs, run tests
  test              - Build and run all tests
  test-unit         - Build and run unit tests only
  test-integration  - Build and run integration tests only
  run               - Run appropriate binary for current OS
  linux-[dist]-[arch] - Build for specific Linux distribution/architecture
  macos-[arch]      - Build for macOS (arm64 or x86_64)
  windows-[arch]    - Build for Windows (x86_64)
----

=== Clean Target

**Usage:** `make clean`

Removes all build artifacts including:
* Compiled binaries
* Object files
* Generated documentation PDFs
* Test executables
* Temporary files

[source,bash]
----
$ make clean
Removing build artifacts...
----

=== Documentation Target

**Usage:** `make docs`

Generates PDF versions of all documentation from AsciiDoc sources:
* Software Requirements Specification (SRS)
* Detailed Design Document (DDD)
* High-Level Design (HLD)
* Test Plan
* User Manual (when created)
* Build Process Documentation (this document)
* All other documentation files

**Process:**
1. Converts Mermaid diagrams to SVG (or PNG if SVG fails)
2. Processes AsciiDoc files with Asciidoctor PDF
3. Outputs PDFs to `build/docs/`

[source,bash]
----
$ make docs
Generating documentation PDFs...
Converting Mermaid diagrams...
Processing Documentation/srs.adoc...
Processing Documentation/ddd.adoc...
...
Documentation generated in build/docs/
----

=== Platform-Specific Build Targets

**Linux Targets:**
* `make linux-debian-arm64` - Debian on ARM64
* `make linux-debian-x86_64` - Debian on x86_64
* `make linux-ubuntu-x86_64` - Ubuntu on x86_64
* `make linux-fedora-x86_64` - Fedora on x86_64
* `make linux-arch-x86_64` - Arch Linux on x86_64
* `make linux` - Auto-detect current Linux distribution and architecture

**macOS Targets:**
* `make macos-arm64` - macOS on Apple Silicon
* `make macos-x86_64` - macOS on Intel
* `make macos` - Auto-detect architecture (universal binary)

**Windows Targets:**
* `make windows-x86_64` - Windows on x86_64

**Build Process:**
1. Builds common library (shared library)
2. Builds Reader application
3. Builds Creator Tool application
4. Builds Server application (Phase 2)
5. Packages distribution artifacts

**Output:**
* Binaries in `build/[platform]/bin/`
* Libraries in `build/[platform]/lib/`
* Distribution packages in `build/[platform]/dist/`

=== Test Targets

**Usage:**
* `make test` - Build test suite, then run all tests (unit + integration)
* `make test-unit` - Build and run unit tests only
* `make test-integration` - Build and run integration tests only
* `make test-build` - Build test suite without execution

**Test Execution:**
[source,bash]
----
$ make test
Building test suite...
Running unit tests...
Running integration tests...
Test Results:
  Unit Tests: 245 passed, 0 failed
  Integration Tests: 89 passed, 0 failed
----

=== All Target

**Usage:** `make all`

Executes complete build process:
1. `make clean` - Remove all build artifacts
2. Build all platform targets
3. `make docs` - Generate documentation
4. `make test` - Build and run tests

**Note:** This is a comprehensive build that may take significant time.

=== Run Target

**Usage:** `make run`

Detects current operating system and architecture, then runs the appropriate binary:
* Linux: Runs `build/linux-[dist]-[arch]/bin/smartbook-reader`
* macOS: Runs `build/macos-[arch]/bin/SmartBook.app/Contents/MacOS/SmartBook`
* Windows: Runs `build/windows-x86_64/bin/smartbook-reader.exe`

**Options:**
* `make run READER` - Run Reader application
* `make run CREATOR` - Run Creator Tool
* `make run SERVER` - Run Server (Phase 2)

== Component Builds

=== Common Library

**Location:** `common/`

**Build:**
[source,bash]
----
cd common
make
----

**Output:**
* Linux: `libsmartbook_common.so`
* macOS: `libsmartbook_common.dylib`
* Windows: `smartbook_common.dll`

**Dependencies:**
* Qt 6.2+ (Core, Gui, Sql)
* SQLite 3.51+

=== Reader Application

**Location:** `reader/`

**Build:**
[source,bash]
----
cd reader
make
----

**Dependencies:**
* Common library (dynamic)
* Qt 6.2+ (Core, Gui, Widgets, WebEngine, WebChannel, Sql)

**Output:**
* Executable binary
* Platform-specific packaging

=== Creator Tool

**Location:** `creator/`

**Build:**
[source,bash]
----
cd creator
make
----

**Dependencies:**
* Common library (dynamic)
* Qt 6.2+ (Core, Gui, Widgets, WebEngine, WebChannel, Sql)

**Output:**
* Executable binary
* Platform-specific packaging

=== Server Application (Phase 2)

**Location:** `server/`

**Build:**
[source,bash]
----
cd server
make
----

**Dependencies:**
* Common library (dynamic)
* Qt 6.2+ (Core, Network, Sql)

**Output:**
* Server executable
* Configuration files

== Test Suite

=== Test Structure

[source]
----
test/
├── Makefile              # Test orchestration
├── unit/                 # Unit tests
│   ├── Makefile
│   ├── test_reader/
│   ├── test_creator/
│   ├── test_common/
│   └── ...
├── integration/          # Integration tests
│   ├── Makefile
│   ├── test_cartridge_loading/
│   ├── test_form_persistence/
│   └── ...
└── common/               # Test utilities
    ├── fixtures/
    ├── mocks/
    └── helpers/
----

=== Running Tests

**All Tests:**
[source,bash]
----
make test
----

**Unit Tests Only:**
[source,bash]
----
make test-unit
----

**Integration Tests Only:**
[source,bash]
----
make test-integration
----

**From Test Directory:**
[source,bash]
----
cd test
make                    # Build test suite
make run                # Run all tests
make run-unit           # Run unit tests
make run-integration    # Run integration tests
----

== Documentation Generation

=== Prerequisites

* Asciidoctor 2.0+
* Asciidoctor PDF
* Mermaid CLI (for diagram conversion)

=== Generating Documentation

**All Documentation:**
[source,bash]
----
make docs
----

**Individual Documents:**
[source,bash]
----
make docs-srs           # Generate SRS PDF only
make docs-ddd           # Generate DDD PDF only
make docs-hld           # Generate HLD PDF only
make docs-test-plan     # Generate Test Plan PDF only
make docs-user-manual   # Generate User Manual PDF only
----

=== Mermaid Diagram Processing

The build process automatically converts Mermaid diagrams to SVG (or PNG if SVG conversion fails):

1. **Mermaid → SVG:** Uses `mmdc` (Mermaid CLI) to convert `.mmd` files to SVG
2. **SVG Fallback:** If SVG conversion fails, converts to PNG instead
3. **Diagram Inclusion:** Diagrams are included inline in AsciiDoc documents

**Manual Conversion:**
[source,bash]
----
# Convert Mermaid to SVG
mmdc -i diagram.mmd -o diagram.svg

# Convert Mermaid to PNG (fallback)
mmdc -i diagram.mmd -o diagram.png -b transparent
----

=== Output Location

All generated PDFs are placed in `build/docs/`:
[source]
----
build/docs/
├── srs.pdf
├── ddd.pdf
├── hld.pdf
├── test-plan.pdf
├── user-manual.pdf
├── build-process.pdf
└── ...
----

== Platform-Specific Build Instructions

=== Linux Builds

**Distribution Detection:**
The build system detects Linux distribution via `/etc/os-release`:
[source,bash]
----
# Detect distribution
DISTRO=$(grep "^ID=" /etc/os-release | cut -d= -f2 | tr -d '"')

# Detect architecture
ARCH=$(uname -m)
# Normalize: x86_64, aarch64, arm64
----

**Supported Distributions:**
* Debian 13+ (ARM64, x86_64)
* Ubuntu 24.04 LTS+ (x86_64)
* Fedora 43+ (x86_64)
* Arch Linux 2025.09.01+ (x86_64)

**Build Example:**
[source,bash]
----
# Build for current system
make linux

# Build for specific distribution/architecture
make linux-debian-x86_64
make linux-debian-arm64
----

=== macOS Builds

**Architecture Detection:**
[source,bash]
----
# Detect architecture
ARCH=$(uname -m)
# arm64 (Apple Silicon) or x86_64 (Intel)
----

**Universal Binary:**
The `make macos` target builds a universal binary supporting both architectures:
[source,bash]
----
make macos              # Universal binary
make macos-arm64        # Apple Silicon only
make macos-x86_64       # Intel only
----

**Code Signing:**
macOS builds include code signing and notarization (if certificates are configured):
[source,bash]
----
# Set signing identity
export CODE_SIGN_IDENTITY="Developer ID Application: Your Name"

# Build with signing
make macos
----

=== Windows Builds

**Build Requirements:**
* Qt 6.2+ installed
* Visual Studio 2019+ or MinGW-w64
* Windows SDK

**Build Example:**
[source,bash]
----
# Using MSVC
make windows-x86_64

# Using MinGW-w64
make windows-x86_64 COMPILER=mingw
----

**Distribution:**
Windows builds create installer packages:
* MSI installer (via WiX or similar)
* EXE installer (via NSIS or similar)

== Development Workflow

=== Initial Setup

. **Clone Repository:**
[source,bash]
----
git clone <repository-url>
cd SmartBook
----

. **Install Prerequisites:**
   * Install Qt 6.2+
   * Install build tools (CMake, compiler)
   * Install documentation tools

. **Verify Setup:**
[source,bash]
----
make help                # Verify Makefile is working
qmake --version          # Verify Qt installation
cmake --version          # Verify CMake installation
----

=== Daily Development

. **Build for Development:**
[source,bash]
----
# Build for current platform
make linux              # or make macos, make windows-x86_64

# Build specific component
cd reader
make
----

. **Run Application:**
[source,bash]
----
make run                # Run Reader
make run CREATOR        # Run Creator Tool
----

. **Run Tests:**
[source,bash]
----
make test               # Run all tests
make test-unit          # Run unit tests during development
----

. **Generate Documentation:**
[source,bash]
----
make docs               # Generate all PDFs
----

=== Before Committing

. **Clean Build:**
[source,bash]
----
make clean
make all                # Full build including tests
----

. **Verify Tests Pass:**
[source,bash]
----
make test
----

. **Check Documentation:**
[source,bash]
----
make docs               # Ensure docs build successfully
----

== Troubleshooting

=== Common Build Issues

**Qt Not Found:**
[source,bash]
----
# Set Qt path
export QTDIR=/path/to/qt6
export PATH=$QTDIR/bin:$PATH
----

**Mermaid Diagram Conversion Fails:**
* Check Mermaid CLI installation: `mmdc --version`
* Verify diagram syntax is valid
* Build will fall back to PNG if SVG fails

**Documentation Generation Fails:**
* Verify Asciidoctor installation: `asciidoctor --version`
* Verify Asciidoctor PDF: `asciidoctor-pdf --version`
* Check AsciiDoc syntax errors

**Test Suite Build Fails:**
* Ensure all dependencies are installed
* Verify test framework is properly configured
* Check test source files for syntax errors

=== Platform-Specific Issues

**Linux:**
* Ensure development packages are installed
* Check library paths: `ldconfig -p | grep qt6`
* Verify architecture matches: `uname -m`

**macOS:**
* Ensure Xcode Command Line Tools are installed
* Check Qt installation path
* Verify code signing certificates (if applicable)

**Windows:**
* Verify Qt installation path in environment
* Check Visual Studio or MinGW-w64 installation
* Ensure Windows SDK is installed

== Build Configuration

=== Environment Variables

**Qt Configuration:**
[source,bash]
----
export QTDIR=/path/to/qt6
export CMAKE_PREFIX_PATH=$QTDIR
----

**Build Type:**
[source,bash]
----
export CMAKE_BUILD_TYPE=Release    # or Debug
----

**Architecture:**
[source,bash]
----
export CMAKE_OSX_ARCHITECTURES="arm64;x86_64"  # macOS universal
----

=== Makefile Variables

Common variables that can be overridden:
[source,makefile]
----
# Compiler
CXX=g++
CXXFLAGS=-std=c++17 -Wall -Wextra

# Qt
QTDIR=/usr/local/qt6

# Build type
BUILD_TYPE=Release

# Installation prefix
PREFIX=/usr/local
----

== Continuous Integration

The build system is designed to work with CI/CD pipelines:

**Example CI Configuration:**
[source,yaml]
----
# .github/workflows/build.yml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y qt6-base-dev qt6-webengine-dev
      - name: Build
        run: make linux-ubuntu-x86_64
      - name: Test
        run: make test
      - name: Generate docs
        run: make docs
----

== Appendix: Makefile Structure

=== Top-Level Makefile Structure

[source,makefile]
----
# Top-level Makefile (simplified structure)

.PHONY: help clean docs all test run

help:
	@echo "Available targets:"
	@echo "  help              - Display this help message"
	@echo "  clean             - Remove all build artifacts"
	@echo "  docs              - Generate all documentation PDFs"
	@echo "  all               - Clean, build all platforms, generate docs, run tests"
	@echo "  test              - Build and run all tests"
	@echo "  run               - Run appropriate binary for current OS"
	@echo "  linux-[dist]-[arch] - Build for specific Linux distribution/architecture"
	@echo "  macos-[arch]      - Build for macOS (arm64 or x86_64)"
	@echo "  windows-[arch]    - Build for Windows (x86_64)"

clean:
	rm -rf build/

docs:
	@echo "Generating documentation PDFs..."
	# Convert Mermaid diagrams
	# Process AsciiDoc files
	# Output to build/docs/

all: clean
	# Build all platforms
	# Generate docs
	# Run tests

test:
	cd test && $(MAKE) build && $(MAKE) run

run:
	# Detect OS and run appropriate binary
----

=== Component Makefile Pattern

Each component follows a similar pattern:
[source,makefile]
----
# Component Makefile (example: reader/Makefile)

.PHONY: all clean install

all: $(TARGET)

$(TARGET): $(OBJECTS)
	$(CXX) $(LDFLAGS) -o $@ $^ $(LIBS)

clean:
	rm -f $(OBJECTS) $(TARGET)

install: $(TARGET)
	install -d $(PREFIX)/bin
	install $(TARGET) $(PREFIX)/bin/
----

== References

* link:srs.adoc[Software Requirements Specification]
* link:ddd.adoc[Detailed Design Document]
* link:hld.adoc[High-Level Design]
* link:test-plan.adoc[Test Plan]
* link:platform-specific-considerations.adoc[Platform-Specific Considerations]

== Revision History

|===
| Date | Version | Changes | Author
| 2025-12-14 | 1.0 | Initial build process documentation | AI Assistant
|===
