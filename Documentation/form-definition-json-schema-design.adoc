= Smartbook Form Definition JSON Schema (v1.0)
:author: Gemini AI Assistant
:revdate: 2025-12-13
:doctype: article
:toc: left
:toclevels: 3

// This document defines the JSON structure stored in the Form_Definitions.form_schema_json column.

== Overview and Purpose

This schema provides a declarative, machine-readable definition for fillable forms within the Smartbook cartridge. It is generated by the Creator Tool and consumed by the Reader's WebEngine for rendering the HTML interface and enforcing client-side validation rules.

== Top-Level Schema Structure

The top-level object defines the form's identity and contains the array of field definitions.

[cols="2, 1, 4, 1, 2"]
|===
| Key | Type | Description | Required? | Example Value

| `schemaVersion` | String | Versioning for the form schema (e.g., handling future format changes). | Yes | `1.0`
| `formId` | String | A unique, permanent identifier for the form. Must match the key used in the `Form_Definitions` table. | Yes | `character_sheet_v3`
| `formTitle` | String | The human-readable title of the form. | Yes | `D&D 5e Character Sheet`
| `fields` | Array | An ordered array containing the definitions for all input elements and structural groups. | Yes | `[...]`
|===

== Field Object Definition

Each element within the `fields` array is a Field Object. This is the core structural element for inputs.

[cols="2, 1, 4, 1, 3"]
|===
| Key | Type | Description | Required? | Notes

| `fieldId` | String | Unique ID used as the HTML `name` attribute and the key for saved data. | Yes | **Crucial for data persistence.**
| `fieldType` | String | Defines the required rendering element. | Yes | e.g., `text`, `number`, `textarea`, `select`, `group`
| `label` | String | The human-readable label displayed to the user. | Yes |
| `defaultValue` | Any | The initial value of the field. | No |
| `placeholder` | String | Placeholder text for input fields. | No |
| `validation` | Object | Object containing client-side validation rules (see Section 4). | No |
| `options` | Array | Required for `select` or `radio` types; lists available choices. | Conditional | Array of `{ "value": X, "label": Y }` objects.
| `children` | Array | Required for `fieldType: "group"`; contains an array of nested field definitions. | Conditional | Allows for hierarchical form design.
|===

== Client-Side Validation Rules (`validation` Object)

These rules are enforced by the WebEngine's JavaScript layer before the data is passed to the C++ core via the secure WebChannel.

[cols="2, 1, 2, 4"]
|===
| Key | Type | Applies To | Description

| `required` | Boolean | All | If `true`, the field cannot be left blank.
| `minLength` | Number | Text, Textarea | Minimum number of characters.
| `maxLength` | Number | Text, Textarea | Maximum number of characters.
| `minValue` | Number | Number | Minimum acceptable numeric value.
| `maxValue` | Number | Number | Maximum acceptable numeric value.
| `regex` | String | Text, Textarea | Custom regular expression string for advanced pattern matching (e.g., email format).
| `errorMsg` | String | All | Custom message to display upon validation failure.
|===

== Example: Nested Form Structure

This example illustrates the use of structural types like `group` and common validation rules.

[source, json]
----
{
  "schemaVersion": "1.0",
  "formId": "project_onboarding_form",
  "formTitle": "New Project Kickoff",
  "fields": [
    {
      "fieldId": "project_name",
      "fieldType": "text",
      "label": "Project Name",
      "validation": { "required": true, "errorMsg": "A project name is required." }
    },
    {
      "fieldId": "project_status",
      "fieldType": "select",
      "label": "Current Phase",
      "defaultValue": "design",
      "options": [
        { "value": "concept", "label": "Concept" },
        { "value": "design", "label": "Detailed Design" },
        { "value": "dev", "label": "Development" }
      ]
    },
    {
      "fieldId": "manager_contact",
      "fieldType": "group",
      "label": "Primary Contact Information",
      "children": [
        {
          "fieldId": "manager_email",
          "fieldType": "text",
          "label": "Manager Email",
          "validation": {
            "required": true,
            "regex": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          }
        },
        {
          "fieldId": "priority_level",
          "fieldType": "number",
          "label": "Priority (1-5)",
          "defaultValue": 3,
          "validation": { "minValue": 1, "maxValue": 5 }
        }
      ]
    },
    {
      "fieldId": "notes",
      "fieldType": "textarea",
      "label": "Scope Notes",
      "validation": { "maxLength": 500 }
    }
  ]
}
----
